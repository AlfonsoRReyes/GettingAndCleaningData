# CodeBook.md



# About the data and the sources
Human Activity Recognition Using Smartphones Dataset

## Measurements
The obtained dataset has been randomly partitioned into two sets, where 70% of the volunteers was selected for generating the training data and 30% the test data. The training data is located under the `train` folder and has been named `X_train.txt`. The test data is located under the `test` folder with the file named `X_test.txt` These files contain 561 variable names that were generated by the sensors.


## The sensors
There are two sensors from which the data is acquired: an __accelerometer__ and a __gyroscope__. Triaxal acceleration readings are collected from the accelerometer, while angular velocity in the tree axis are read from the gyroscope. Additionally these measurements are processed under two domains: time and frequency. All of these measurements total __561 variables__.



# Measurements and Auxiliary Data frames

## The `train` data frame
This shows a summary of the `train` data frame after loading the file `X_train.txt`.


```r
library(dplyr)
source("run_analysis.R")
train <- read.table("./data/UCI HAR Dataset/train/X_train.txt")    # read test dataset: 62.9 MB
short_summary(train)
```

```
Observations: 	 7352 			First variables: V1 V2 V3 V4 V5 V6 
Variables: 	 561 			Last variables: V556 V557 V558 V559 V560 V561 

First observations
         V1       V141       V281       V421        V561
1 0.2885845 -0.9786140 -0.9747327 -0.9986807 -0.05862692
2 0.2784188 -0.9893447 -0.9858116 -0.9996510 -0.05431672
3 0.2796531 -0.9951443 -0.9858213 -0.9995138 -0.04911782
4 0.2791739 -0.9941653 -0.9928120 -0.9992066 -0.04766318
5 0.2766288 -0.9933367 -0.9924232 -0.9992106 -0.04389225
6 0.2771988 -0.9929940 -0.9950023 -0.9994048 -0.04212638

Summary of selected variables
```

```
       V1               V141              V281              V421        
 Min.   :-1.0000   Min.   :-1.0000   Min.   :-1.0000   Min.   :-1.0000  
 1st Qu.: 0.2630   1st Qu.:-0.9871   1st Qu.:-0.9869   1st Qu.:-0.9995  
 Median : 0.2772   Median :-0.9356   Median :-0.9055   Median :-0.9979  
 Mean   : 0.2745   Mean   :-0.7132   Mean   :-0.5541   Mean   :-0.9291  
 3rd Qu.: 0.2885   3rd Qu.:-0.4954   3rd Qu.:-0.1051   3rd Qu.:-0.9133  
 Max.   : 1.0000   Max.   : 1.0000   Max.   : 1.0000   Max.   : 1.0000  
      V561          
 Min.   :-1.000000  
 1st Qu.:-0.143414  
 Median : 0.003181  
 Mean   :-0.056515  
 3rd Qu.: 0.107659  
 Max.   : 1.000000  
```


## The `test` data frame
This shows a summary of the `test` data frame after loading the file `X_test.txt`.


```r
library(dplyr)
source("run_analysis.R")
test <- read.table("./data/UCI HAR Dataset/test/X_test.txt")    # read test dataset: 25.2 MB
short_summary(test)
```

```
Observations: 	 2947 			First variables: V1 V2 V3 V4 V5 V6 
Variables: 	 561 			Last variables: V556 V557 V558 V559 V560 V561 

First observations
         V1       V141       V281       V421        V561
1 0.2571778 -0.9061043 -0.8650632 -0.9984601 -0.05797830
2 0.2860267 -0.9606847 -0.9576235 -0.9985726 -0.08389801
3 0.2754848 -0.9861989 -0.9771138 -0.9990731 -0.07934620
4 0.2702982 -0.9716812 -0.9786883 -0.9987950 -0.07710800
5 0.2748330 -0.9815836 -0.9829645 -0.9995514 -0.07385681
6 0.2792199 -0.9820461 -0.9827866 -0.9994356 -0.06847070

Summary of selected variables
```

```
       V1               V141              V281              V421         
 Min.   :-0.5920   Min.   :-0.9990   Min.   :-0.9989   Min.   :-0.99999  
 1st Qu.: 0.2621   1st Qu.:-0.9828   1st Qu.:-0.9835   1st Qu.:-0.99944  
 Median : 0.2771   Median :-0.9148   Median :-0.8744   Median :-0.99613  
 Mean   : 0.2740   Mean   :-0.7271   Mean   :-0.5582   Mean   :-0.94097  
 3rd Qu.: 0.2881   3rd Qu.:-0.5329   3rd Qu.:-0.1423   3rd Qu.:-0.91959  
 Max.   : 0.6719   Max.   : 0.5487   Max.   : 0.5770   Max.   :-0.07175  
      V561         
 Min.   :-0.94923  
 1st Qu.:-0.09848  
 Median :-0.01067  
 Mean   :-0.04872  
 3rd Qu.: 0.09237  
 Max.   : 0.97311  
```

## Observations about the data frames for the measurements 
From the short reports printed above, we can appreciate that both data frames `train` with 7352 observations, and `test` with 2947 observations, hold the same number of variables (561), which facilitates the merging operations later. The variable names are the default and are labeled as "Vnnn" where _nnn_ is the variable number from 1 through 561. Later, these variable names will be reassigned with the ones used by the researchers.


## Subjects and Activities
The experiments have been carried out with a group of `30 volunteers` within an age bracket of 19-48 years. Each person performed six activities (`WALKING, WALKING_UPSTAIRS, WALKING_DOWNSTAIRS, SITTING, STANDING, LAYING`) wearing a smartphone.



### Subjects data frame for the `train` dataset
The `subjects` data frame is generated by reading the file `subject_name.txt`, where name could take either of two values: `train` or `test`. We will use this file naming convention in our advantage later by applying one common function to both data frames. Below is shown a short summary of `subjects` data frame.


```r
subject_train <- read.table("./data/UCI HAR Dataset/train/subject_train.txt") 
short_summary(subject_train)
```

```
Observations: 	 7352 			First variables: V1 
Variables: 	 1 			Last variables: V1 

First observations
  V1
1  1
2  1
3  1
4  1
5  1
6  1

Summary of selected variables
```

```
       V1       
 Min.   : 1.00  
 1st Qu.: 8.00  
 Median :19.00  
 Mean   :17.41  
 3rd Qu.:26.00  
 Max.   :30.00  
```


```

Vector Class: integer
```

```
	Subject IDs: 1 3 5 6 7 8 11 14 15 16 17 19 21 22 23 25 26 27 28 29 30
```
Note that the subject IDs for the `train` data frame are not continuous from 1 through 30; some IDs are missing. These IDs will be found in the `test` data frame.



### Subjects data frame for `test` dataset
The `subjects` data frame for `test` is generated by reading the file `subject_test.txt`. Below is shown a short summary of `subjects` data frame for the `test` dataset.


```r
subject_test <- read.table("./data/UCI HAR Dataset/test/subject_test.txt") 
short_summary(subject_test)
```

```
Observations: 	 2947 			First variables: V1 
Variables: 	 1 			Last variables: V1 

First observations
  V1
1  2
2  2
3  2
4  2
5  2
6  2

Summary of selected variables
```

```
       V1       
 Min.   : 2.00  
 1st Qu.: 9.00  
 Median :12.00  
 Mean   :12.99  
 3rd Qu.:18.00  
 Max.   :24.00  
```


```

Vector Class: integer
```

```
	Subject IDs: 2 4 9 10 12 13 18 20 24
```
We now can observe that the subject IDs missing values in the `train` dataset appear in the `test` dataset, which is expected according to the rules of the experiment: _The obtained dataset has been randomly partitioned into two sets, where 70% of the volunteers was selected for generating the training data and 30% the test data._

> Later on, both subjects data frames will be merged with their corresponding measurement data frames, `train` and `test`.


## Activity labels
The activity labels are read from the file `activity_labels.txt`. We show a view of the data frame:


```r
# read activity labels. They are 6 activity label variables
# rows: 6
# V1:   activity ID
# V2:   activity description
# file: "./data/UCI HAR Dataset/activity_labels.txt"
activity_labels <<- read.table("./data/UCI HAR Dataset/activity_labels.txt")
activity_labels
```

```
  V1                 V2
1  1            WALKING
2  2   WALKING_UPSTAIRS
3  3 WALKING_DOWNSTAIRS
4  4            SITTING
5  5           STANDING
6  6             LAYING
```
The activity labels are stored in the second column of the data frame. The first column is the ID. This `ID` will be used later to merge this data frame against the measurement data frames `train` and `test`.


```
[1] "WALKING"            "WALKING_UPSTAIRS"   "WALKING_DOWNSTAIRS"
[4] "SITTING"            "STANDING"           "LAYING"            
```



## Activities data frames for `train` and `test`
In the same way as the `Subjects` data frames for `train` and `test` were structured, there are two data frames that will be used to link the activity being performed by the subject on each of the `nrow(train)` and `nrow(test)` observations, respectively. Let's take a look at the data frames:

__activity_train__


```r
activity_train <- read.table("./data/UCI HAR Dataset/train/y_train.txt") 
short_summary(activity_train)
```

```
Observations: 	 7352 			First variables: V1 
Variables: 	 1 			Last variables: V1 

First observations
  V1
1  5
2  5
3  5
4  5
5  5
6  5

Summary of selected variables
```

```
       V1       
 Min.   :1.000  
 1st Qu.:2.000  
 Median :4.000  
 Mean   :3.643  
 3rd Qu.:5.000  
 Max.   :6.000  
```
As we can see above, there are 7352 observations in this `activity_train` data frame. They correspond exactly with the number of observations of the `train` measurements data frame.

We can also observe that the activity IDs show 6 id numbers even though there are 7352 observations in this data frame.

```r
# uniques ID for the train activity dataframe
sort(unique(activity_train$V1))
```

```
[1] 1 2 3 4 5 6
```

__activity_test__



```r
activity_test <- read.table("./data/UCI HAR Dataset/test/y_test.txt") 
short_summary(activity_test)
```

```
Observations: 	 2947 			First variables: V1 
Variables: 	 1 			Last variables: V1 

First observations
  V1
1  5
2  5
3  5
4  5
5  5
6  5

Summary of selected variables
```

```
       V1       
 Min.   :1.000  
 1st Qu.:2.000  
 Median :4.000  
 Mean   :3.578  
 3rd Qu.:5.000  
 Max.   :6.000  
```
As we can see above, there are 2947 observations in this `activity_test` data frame. They correspond exactly with the number of observations of the `test` measurements data frame.

We can also observe that the activity IDs show 6 id numbers even though there are 2947 observations in this data frame.

```r
# uniques ID for the test activity dataframe
sort(unique(activity_test$V1))
```

```
[1] 1 2 3 4 5 6
```

# Construction and transformations of the data sets for analysis
After taking a look at the auxiliarey data frames for the subject and activities we will move on the measurements data frames. These data frames `train` and `test` contain each 561 variables but both with different amount of observations.

These data frames are in a raw form as describe here:

* They do not have descriptive names for the variables
* The measurements do not have any sort of ID variable for the subject under analysis or an ID for any kind of actovity being performed by the subject. 
* No siginificant analysis can be performed on any of these data frames; we only know that the variables are numerical.

We will need to perform several operations to have the data frames `train` and `test` ready for analysis. The operations are:

1. Read the variables names 
2. Find that all variable names are unique using function `compose_features()`
3. Mark variable names that are repeating
4. Find why the variable is repeating its name
5. Fix the names of the repeating variables
6. Convert the variable names to *nice* variables names using function `make_nice_variables()`
7. Merge the data frame with corrected variable names with the measurement data frames
8. Merge the subjects data frames with the measurements data frames
9. Merge the activity data frames with the measurement data frames
10. Remove variables that do not contain the keywords `mean` and `std`
11. Merge the two measurement data frames `train` and `test`
12. Create a summary table based on the subjects ID and activity ID applying the mean to the measurements
13. Write the summary table to a file



## Read the variables names
We start by reading the variables names from the file `features.txt`. This is performed by the code in the function `run_ana()`. The file is already living in the local folder, so we indicate the name of the file with the object `fileName` as shown in the snippet below. The `fileName` is used by the function `compose_features()` to start the work of processing operations: reading the file, creating a data frame, finding the variables that are duplicates, marking those duplicates in the data frame, converting those variables names in correct ones so the deuplicates are eliminated. Then, finally these variable names are removed from any character as per best practices dictate.

Once the variable names have been processed, an object `valid_column_names` will receive them to be later merged with the measurements data frames.


```r
# read common tables such as activity labels and features (column names for measurements)
  
  # read variable/column names. Also called features. 561 elements.
  # rows:  561. Matches the number of columns in the measurement datasets
  # V1:    record number
  # V2:    variable name or feature
  fileName <- "./data/UCI HAR Dataset/features.txt"
  
  # ensure valid names for the variables. Making valid_column_names GLOBAL
  # will read a table of the variable names after clean up
  # rows:             561
  # columns:          1 (returning as character vector)
  # name of column:   nice
  # env:              global
  # characteristics:  variable names. No parentheses, no duplicates, no dashes, no dots
  valid_column_names <<- compose_features(fileName)
```





## Find that all variable names are unique
The detection of unique variable names is performed inside the `compose_features()` function. 

```r
  # takes care of the proper validation of the variables names
  # features <- read.table("./data/UCI HAR Dataset/features.txt")
  features <- read.table(fileName)
  
  # convert factors to character vector
  features <- features %>%
    mutate(V2 = as.character(V2))
  
  # get counts for all rows and duplicate rows
  all_rows <- nrow(features)
  duplicate_rows <- length(features$V2[(duplicated(features$V2) | duplicated(features$V2, fromLast = TRUE))])
  list(all_rows=all_rows, duplicates=duplicate_rows)
```

```
$all_rows
[1] 561

$duplicates
[1] 126
```
We can see from the results above that there are 126 duplicate variable names. We find them by using the R function `duplicated()`, reading from both sides, the beginning of the vector and from the end of the vector. We do this to force the inclusion of the original variables that were causing the repetition and not only the repeating variables.



## Mark variable names that are repeating

## Find why the variable is repeating its name

## what are the columns that are repeating


## Dealing with the repeating columns
We find that there are 3 groups of variables:

* fBodyAcc-bandsEnergy
* fBodyAccJerk-bandsEnergy
* fBodyGyro-bandsEnergy

Each of this variables have 42 energy measurements on three different windows (w1, w2, w3), and on three different axis (X, Y, Z). These variables need to be renamed accordingly to avoid repeating name of the columns.

The windows have different resolutions: `w1` has 8 steps bins like this: 1-8, [9, 16], [17, 24], [25, 32], [33, 40], [41, 48], [49, 56] and [56, 64]. `w2` has a 16 steps bins: [1, 16], [17, 32], [33, 48] and [49, 64]. `w3` has a step of 24 bins: [1, 24] and [25, 48]; id doesn't go up to 64.

These three windows (w1, w2, w3) read over the X, Y and Z axis. To differentiate the repeating columns we will have to add the axis to each of the windows.



## Assign descriptive names to train data set

## Keep only mean and std-dev variables


## Read subjects dataset

## Merging datasets
This action has 3 parts:

1. Merging the train_activities table with the activities table (with descriptive names)

2. Merging the joined table above (train_activities_inner) with the train measurments dataset.

3. Merging the subjects table with train table



# Getting the data. Acquiring the datasets

We start by downloading the zipped file containing all the datasets and associated files.
We load the library `downloader` to allow us the use of the function `download()`.

Since we want to make this analysis reproducible, we added the capability of detecting if the folder `data` exists in the folder structure. If it doesn't exist, the script will create it for the user. Downloading and extracting the files will take few minutes.


```r
library(downloader)

if(!file.exists("./data")){dir.create("./data")}

fileUrl <- "https://d396qusza40orc.cloudfront.net/getdata%2Fprojectfiles%2FUCI%20HAR%20Dataset.zip"

# download(fileUrl, dest="dataset.zip", mode="wb") 
# unzip ("dataset.zip", exdir = "./data")
```

