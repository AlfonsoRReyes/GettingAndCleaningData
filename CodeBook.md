# CodeBook.md



--------

# About the data and the sources
This data analysis project is based on data generated during the _Human Activity Recognition Using Smartphones Dataset_ research.

## Measurements
The obtained dataset generated during the experiments has been randomly partitioned into two sets, where __70%__ of the volunteers was selected for generating the training data and __30%__ the test data. The `training data` is located under the `train` folder and has been named `X_train.txt`. The `test data` is located under the `test` folder with the file named `X_test.txt` These files contain __561__ variable names generated by two electronic sensors.

From now on, we will be referring to `measurements` to any of the two datasets with 561 variable names, either the `train` or `test` data frames.


## The sensors
There are two sensors from which the data is acquired: an __accelerometer__ and a __gyroscope__. Triaxal acceleration readings are collected from the accelerometer, while angular velocity in the three axis are read from the gyroscope. Additionally, these measurements are processed under two domains: time and frequency (fourier analysis). All of these measurements have recorded in __561 variables__.





# Measurements and Auxiliary Data frames

## The `train` data frame
This shows a summary of the `train` data frame after loading the file `X_train.txt`. We will call it raw data at this point.


```r
library(dplyr)
library(stringr)

source("run_analysis.R")

train_measurements_raw <- raw_measurements_data("train")$measurements   # read test dataset: 62.9 MB
short_summary(train_measurements_raw)
```

```
Observations: 	 7352 			First variables: V1 V2 V3 V4 V5 V6 
Variables: 	 561 			Last variables: V556 V557 V558 V559 V560 V561 

First observations
         V1       V141       V281       V421        V561
1 0.2885845 -0.9786140 -0.9747327 -0.9986807 -0.05862692
2 0.2784188 -0.9893447 -0.9858116 -0.9996510 -0.05431672
3 0.2796531 -0.9951443 -0.9858213 -0.9995138 -0.04911782
4 0.2791739 -0.9941653 -0.9928120 -0.9992066 -0.04766318
5 0.2766288 -0.9933367 -0.9924232 -0.9992106 -0.04389225
6 0.2771988 -0.9929940 -0.9950023 -0.9994048 -0.04212638

Summary of selected variables
```

```
       V1               V141              V281              V421        
 Min.   :-1.0000   Min.   :-1.0000   Min.   :-1.0000   Min.   :-1.0000  
 1st Qu.: 0.2630   1st Qu.:-0.9871   1st Qu.:-0.9869   1st Qu.:-0.9995  
 Median : 0.2772   Median :-0.9356   Median :-0.9055   Median :-0.9979  
 Mean   : 0.2745   Mean   :-0.7132   Mean   :-0.5541   Mean   :-0.9291  
 3rd Qu.: 0.2885   3rd Qu.:-0.4954   3rd Qu.:-0.1051   3rd Qu.:-0.9133  
 Max.   : 1.0000   Max.   : 1.0000   Max.   : 1.0000   Max.   : 1.0000  
      V561          
 Min.   :-1.000000  
 1st Qu.:-0.143414  
 Median : 0.003181  
 Mean   :-0.056515  
 3rd Qu.: 0.107659  
 Max.   : 1.000000  
```


## The `test` data frame
This shows a summary of the `test` data frame after loading the file `X_test.txt`. We call it raw data at this point.


```r
# library(dplyr)
# source("run_analysis.R")
test_measurements_raw <- raw_measurements_data("test")$measurements
short_summary(test_measurements_raw)
```

```
Observations: 	 2947 			First variables: V1 V2 V3 V4 V5 V6 
Variables: 	 561 			Last variables: V556 V557 V558 V559 V560 V561 

First observations
         V1       V141       V281       V421        V561
1 0.2571778 -0.9061043 -0.8650632 -0.9984601 -0.05797830
2 0.2860267 -0.9606847 -0.9576235 -0.9985726 -0.08389801
3 0.2754848 -0.9861989 -0.9771138 -0.9990731 -0.07934620
4 0.2702982 -0.9716812 -0.9786883 -0.9987950 -0.07710800
5 0.2748330 -0.9815836 -0.9829645 -0.9995514 -0.07385681
6 0.2792199 -0.9820461 -0.9827866 -0.9994356 -0.06847070

Summary of selected variables
```

```
       V1               V141              V281              V421         
 Min.   :-0.5920   Min.   :-0.9990   Min.   :-0.9989   Min.   :-0.99999  
 1st Qu.: 0.2621   1st Qu.:-0.9828   1st Qu.:-0.9835   1st Qu.:-0.99944  
 Median : 0.2771   Median :-0.9148   Median :-0.8744   Median :-0.99613  
 Mean   : 0.2740   Mean   :-0.7271   Mean   :-0.5582   Mean   :-0.94097  
 3rd Qu.: 0.2881   3rd Qu.:-0.5329   3rd Qu.:-0.1423   3rd Qu.:-0.91959  
 Max.   : 0.6719   Max.   : 0.5487   Max.   : 0.5770   Max.   :-0.07175  
      V561         
 Min.   :-0.94923  
 1st Qu.:-0.09848  
 Median :-0.01067  
 Mean   :-0.04872  
 3rd Qu.: 0.09237  
 Max.   : 0.97311  
```

## Observations about the data frames for the measurements 
From the short reports printed above, we can appreciate that both data frames `train` with 7352 observations, and `test` with 2947 observations, hold the same number of variables (561), which facilitates the merging operations later. The variable names are the default and are labeled as __"Vnnn"__ where _nnn_ is the variable number from 1 through 561. Later, these default variable names will be reassigned by the ones used by the researchers.


## Subjects and Activities
The experiments have been carried out with a group of `30 volunteers` within an age bracket of 19-48 years. Each person performed six activities (`WALKING, WALKING_UPSTAIRS, WALKING_DOWNSTAIRS, SITTING, STANDING, LAYING`) wearing a smartphone. The number of observations from these two data frames match the number of observations in the measurements data frames. These data frames will be later be merged to provide a consolidated data source of the training and tests.



### Subjects data frame for the `train` dataset
The `subjects` data frame is generated by reading the file `subject_name.txt`, where _name_ could take either of two values: `train` or `test`. We will use this file naming convention in our advantage later by applying one common function to both data frames. Below is shown a short summary of `subjects` data frame.


```r
train_subjects_raw     <- raw_measurements_data("train")$subjects 
short_summary(train_subjects_raw)
```

```
Observations: 	 7352 			First variables: V1 
Variables: 	 1 			Last variables: V1 

First observations
  V1
1  1
2  1
3  1
4  1
5  1
6  1

Summary of selected variables
```

```
       V1       
 Min.   : 1.00  
 1st Qu.: 8.00  
 Median :19.00  
 Mean   :17.41  
 3rd Qu.:26.00  
 Max.   :30.00  
```



```

Vector Class: integer
```

```
	Subject IDs: 1 3 5 6 7 8 11 14 15 16 17 19 21 22 23 25 26 27 28 29 30
```
Note that the subject IDs for the `train` data frame are not continuous from 1 through 30; some IDs are missing. These IDs will be found in the `test` data frame.



### Subjects data frame for the `test` dataset
The `subjects` data frame for `test` is generated by reading the file `subject_test.txt`. Below is shown a short summary of `subjects` data frame for the `test` dataset.


```r
test_subjects_raw     <- raw_measurements_data("test")$subjects 
short_summary(test_subjects_raw)
```

```
Observations: 	 2947 			First variables: V1 
Variables: 	 1 			Last variables: V1 

First observations
  V1
1  2
2  2
3  2
4  2
5  2
6  2

Summary of selected variables
```

```
       V1       
 Min.   : 2.00  
 1st Qu.: 9.00  
 Median :12.00  
 Mean   :12.99  
 3rd Qu.:18.00  
 Max.   :24.00  
```


```

Vector Class: integer
```

```
	Subject IDs: 2 4 9 10 12 13 18 20 24
```
We now can observe that the subject IDs missing values in the `train` dataset appear in the `test` dataset, which is expected according to the rules of the experiment: _The obtained dataset has been randomly partitioned into two sets, where 70% of the volunteers was selected for generating the training data and 30% the test data._

> Later on, both subjects data frames will be merged with their corresponding measurement data frames, `train` and `test`.


## Activity labels
The activity labels are read from the file `activity_labels.txt`. The activities are common to the training and tests experiments. We show a view of the data frame:


```r
# read activity labels. They are 6 activity label variables
# rows: 6
# V1:   activity ID
# V2:   activity description
# file: "./data/UCI HAR Dataset/activity_labels.txt"
activity_labels <<- read.table("./data/UCI HAR Dataset/activity_labels.txt")
activity_labels
```

```
  V1                 V2
1  1            WALKING
2  2   WALKING_UPSTAIRS
3  3 WALKING_DOWNSTAIRS
4  4            SITTING
5  5           STANDING
6  6             LAYING
```
The activity labels are stored in the second column of the data frame. The first column corrsponds to the ID. This `ID` will be used later to merge this data frame against the measurement data frames `train` and `test` to replace the activity ID by a descriptive name, i.e., walking, sitting, standing, etc.


```
[1] "WALKING"            "WALKING_UPSTAIRS"   "WALKING_DOWNSTAIRS"
[4] "SITTING"            "STANDING"           "LAYING"            
```



## Activities data frames for `train` and `test`
In the same way as the `Subjects` data frames for `train` and `test` were structured, there are two data frames that will be used to link the activity being performed by the subject on each of the 7352 and 2947 observations, respectively. Let's take a look at the data frames:

### activity_train data frame


```r
train_activities_raw   <- raw_measurements_data("train")$activities 
short_summary(train_activities_raw)
```

```
Observations: 	 7352 			First variables: V1 
Variables: 	 1 			Last variables: V1 

First observations
  V1
1  5
2  5
3  5
4  5
5  5
6  5

Summary of selected variables
```

```
       V1       
 Min.   :1.000  
 1st Qu.:2.000  
 Median :4.000  
 Mean   :3.643  
 3rd Qu.:5.000  
 Max.   :6.000  
```
As we can see above, there are 7352 observations in this `activity_train` data frame. They correspond exactly with the number of observations of the `train` measurements data frame. We can also observe that the activity IDs show __6__ id numbers even though there are 7352 observations in this data frame.

```r
# uniques ID for the train activity dataframe
sort(unique(train_activities_raw$V1))
```

```
[1] 1 2 3 4 5 6
```

### activity_test data frame


```r
test_activities_raw   <- raw_measurements_data("test")$activities 
short_summary(test_activities_raw)
```

```
Observations: 	 2947 			First variables: V1 
Variables: 	 1 			Last variables: V1 

First observations
  V1
1  5
2  5
3  5
4  5
5  5
6  5

Summary of selected variables
```

```
       V1       
 Min.   :1.000  
 1st Qu.:2.000  
 Median :4.000  
 Mean   :3.578  
 3rd Qu.:5.000  
 Max.   :6.000  
```
As we can see above, there are 2947 observations in this `activity_test` data frame. They correspond exactly with the number of observations of the `test` measurements data frame. We can also observe that the activity IDs show 6 id numbers even though there are __2947__ observations in this data frame, which matches the __activity_labels__ data frame with descriptive names.


```r
# uniques ID for the test activity dataframe
sort(unique(test_activities_raw$V1))
```

```
[1] 1 2 3 4 5 6
```

# Construction and transformations of the data sets
After taking a look at the auxiliary data frames for the subject and activities, we will move on the measurements data frames. These data frames `train` and `test` contain each 561 variables but both with different amount of observations.

These data frames are in a raw form as describe here:

* They do not have descriptive names for the variables
* The measurements do not have any sort of ID variable for the subject under analysis or an ID for any kind of activity being performed by the subject. 
* No siginificant analysis can be performed on any of these data frames; we only know that the 561 variables are numerical.
* The researchers preferred to separate the experiement data sets in different data members, possibly, to facilitate the work of  peer reviewers.

We will need to perform several operations to have the data frames `train` and `test` ready for our data analysis. The operations are:

1. Read the variables names from `features.txt`.
2. Find that all variable names are unique using function 
3. Mark variable names that are repeating
4. Find why the variable is repeating its name
5. Fix the names of the repeating variables
6. Convert the variable names to *nice* variables names using function `make_nice_variables()`
7. Merge the data frame with corrected `variable names` with the measurement data frames `train` and `test`
8. Merge the `subjects` data frames with the measurements data frames `train` and `test`
9. Merge the `activities` data frames with the measurement data frames `train` and `test`
10. Remove variables that do not contain the keywords `mean` and `std`
11. Merge the two measurement data frames `train` and `test`
12. Create a summary table based on the subjects ID and activity ID applying the mean to the measurement variables.
13. Write the summary table to a file.



## Read the variables names
We start by reading the variables names from the file `features.txt`. This is performed by the code in the function `run_ana()` inside the script. The file is already living in the local folder, so we indicate the name of the file with the object `fileName` as shown in the snippet below. The `fileName` is used by the function `compose_features()` to start the work of processing operations: reading the file, creating a data frame, finding the variables that are duplicates, marking those duplicates in the data frame, converting those variables names in correct ones so the deuplicates are eliminated. Then, finally these variable names are removed from any character as per best practices dictate.

Once the variable names have been processed, a vector object `valid_column_names` will receive them to be later merged with the measurements data frames. The valid column names will replace the default variable names __V1-V561__. Below we can see the code that makes that variable name substitution.


```r
  # load variable names or features
  # read variable/column names. Also called features. 561 elements.
  # rows:  561. Matches the number of columns in the measurement datasets
  # V1:    record number
  # V2:    variable name or feature
  fileName <- "./data/UCI HAR Dataset/features.txt"
  features <- read.table(fileName)
  
  # ensure valid names for the variables. 
  # rows:             561
  # columns:          1 (returning as character vector)
  # name of column:   nice
  # characteristics:  variable names. No parentheses, no duplicates, no dashes, no dots
  valid_column_names <- compose_features(features)
```

Here is a sample of the fixed variable names:

```r
valid_column_names[10:50]
```

```
 [1] "tbodyaccmaxx"          "tbodyaccmaxy"         
 [3] "tbodyaccmaxz"          "tbodyaccminx"         
 [5] "tbodyaccminy"          "tbodyaccminz"         
 [7] "tbodyaccsma"           "tbodyaccenergyx"      
 [9] "tbodyaccenergyy"       "tbodyaccenergyz"      
[11] "tbodyacciqrx"          "tbodyacciqry"         
[13] "tbodyacciqrz"          "tbodyaccentropyx"     
[15] "tbodyaccentropyy"      "tbodyaccentropyz"     
[17] "tbodyaccarcoeffx1"     "tbodyaccarcoeffx2"    
[19] "tbodyaccarcoeffx3"     "tbodyaccarcoeffx4"    
[21] "tbodyaccarcoeffy1"     "tbodyaccarcoeffy2"    
[23] "tbodyaccarcoeffy3"     "tbodyaccarcoeffy4"    
[25] "tbodyaccarcoeffz1"     "tbodyaccarcoeffz2"    
[27] "tbodyaccarcoeffz3"     "tbodyaccarcoeffz4"    
[29] "tbodyacccorrelationxy" "tbodyacccorrelationxz"
[31] "tbodyacccorrelationyz" "tgravityaccmeanx"     
[33] "tgravityaccmeany"      "tgravityaccmeanz"     
[35] "tgravityaccstdx"       "tgravityaccstdy"      
[37] "tgravityaccstdz"       "tgravityaccmadx"      
[39] "tgravityaccmady"       "tgravityaccmadz"      
[41] "tgravityaccmaxx"      
```





## Find that all variable names are unique
The detection of unique variable names is performed inside the `compose_features()` function. 



```r
  all_rows       <- get_duplicates_count(features)$all_rows
  duplicate_rows <- get_duplicates_count(features)$duplicates
  
  all_rows
```

```
[1] 561
```

```r
  duplicate_rows
```

```
[1] 126
```


We can see from the results above that there are __126__ duplicate variable names out of a total of __561__. We find them by using the R function `duplicated()`, reading from both sides of the vector, the beginning of the vector and from the end of the vector. We do this to force the inclusion of the original variables that were causing the repetition and not only the repeating variables. This is why the extended form of duplicated() is used: `duplicated(features$V2, fromLast = TRUE)`.


## Mark variable names that are repeating
At this point we have detected 126 duplicates. But we need a way to store the good and bad variables names for further processing. In lieue of this, we create a utility data frame called `features2` that will hold all the variable names. To mark the duplicates we add a column called `duplicate` where we store the logical status; `FALSE` if the variable is no duplicate, or `TRUE` if the variable is duplicate.



```r
  # add logical marker for duplicates
  features2 <- add_logical_marker_for_dups(features)
```


The data frame looks like this (we show just a few of the variables):

```r
features2[c(1, 100, 303, 317, 561), ]
```

```
     V1                         V2 duplicate
1     1          tBodyAcc-mean()-X     FALSE
100 100       tBodyAccJerk-iqr()-X     FALSE
303 303 fBodyAcc-bandsEnergy()-1,8      TRUE
317 317 fBodyAcc-bandsEnergy()-1,8      TRUE
561 561       angle(Z,gravityMean)     FALSE
```
It can be seen here that the rows 303 and 317, just for an example, are duplicate. If we don't remove, we could not be talking about a tidy dataset. Besides the conflict that could arise during variable selection.


## Find why the variable is repeating its name
To find out why the variables have repeating names we could take a look at the first group of variables that have this problem. The explanation is this:

* There are 126 duplicate variable names out of 561 total. These variables have something in common: they are measurements taken for __three different type of bin__.

* These bins have a window range with three types of steps (8, 16 and 24). And all they finish at the bin 64, for the first two, and 48 for the latter. The only thing that changes is the step. To use this fact in our advantage, for each of these a window number is assigned.

* If we add these bins we get a total of 8, 4 and 2, or __14 bin sets__. Let's see how they look:


```r
print(features2[303:319,])
```

```
     V1                           V2 duplicate
303 303   fBodyAcc-bandsEnergy()-1,8      TRUE
304 304  fBodyAcc-bandsEnergy()-9,16      TRUE
305 305 fBodyAcc-bandsEnergy()-17,24      TRUE
306 306 fBodyAcc-bandsEnergy()-25,32      TRUE
307 307 fBodyAcc-bandsEnergy()-33,40      TRUE
308 308 fBodyAcc-bandsEnergy()-41,48      TRUE
309 309 fBodyAcc-bandsEnergy()-49,56      TRUE
310 310 fBodyAcc-bandsEnergy()-57,64      TRUE
311 311  fBodyAcc-bandsEnergy()-1,16      TRUE
312 312 fBodyAcc-bandsEnergy()-17,32      TRUE
313 313 fBodyAcc-bandsEnergy()-33,48      TRUE
314 314 fBodyAcc-bandsEnergy()-49,64      TRUE
315 315  fBodyAcc-bandsEnergy()-1,24      TRUE
316 316 fBodyAcc-bandsEnergy()-25,48      TRUE
317 317   fBodyAcc-bandsEnergy()-1,8      TRUE
318 318  fBodyAcc-bandsEnergy()-9,16      TRUE
319 319 fBodyAcc-bandsEnergy()-17,24      TRUE
```
On purpose, two bin sets are included to notice the repetition. This is clear in rows __303__ and __317__, the variable names start repeating.


```r
print(features2[c(303,317),])
```

```
     V1                         V2 duplicate
303 303 fBodyAcc-bandsEnergy()-1,8      TRUE
317 317 fBodyAcc-bandsEnergy()-1,8      TRUE
```



## Dealing with the repeating columns
These 126 variable names are corrected by adding their bin window and the corresponding axis for the observation. There are three axis: x, y and z. For instance, if the correction by window and axis is not performed, then a variable name such as fnnxnxn() would repeat three times per axis, per bin window. 

Therefore, there are __3 kinds of bin windows__ and __14 bins per axis__. Since there are three axis, we end up with 14 x 3 x 3 = 126 variable names that will be finally corrected using this technique.

### Correction algorithm
This is what will be done: 
* (1) get the bin window range which has three types of steps (8, 16 and 24); 
* (2) calculate the step and apply the corresponding bin window name (w1, w2 or w3); 
* (3) assign the axis to a column; 
* (4) perform the concatenation of the original variable name with its corresponding bin window name and axis. 

### Description of the steps
We find that there are 3 groups of variables:

* fBodyAcc-bandsEnergy
* fBodyAccJerk-bandsEnergy
* fBodyGyro-bandsEnergy

Each of this variables have 42 energy measurements on three different windows (w1, w2, w3), and on three different axis (X, Y, Z). These variables need to be renamed accordingly to avoid repeating name of the columns.

The windows have different resolutions: `w1` has 8 steps bins like this: 1-8, [9, 16], [17, 24], [25, 32], [33, 40], [41, 48], [49, 56] and [56, 64]. `w2` has a 16 steps bins: [1, 16], [17, 32], [33, 48] and [49, 64]. `w3` has a step of 24 bins: [1, 24] and [25, 48]; id doesn't go up to 64.

These three windows (w1, w2, w3) read over the X, Y and Z axis. To differentiate the repeating columns we will have to add the axis to each of the windows.

### Code
The following code makes possible to add the bin windows and axis for the measurement. 



```r
  # get subset of features. working only with subset of duplicates
  features_dup <- fix_duplicates(features2)
```

### Results
After applying the correction algorithm, the variables will look like this:


```r
features_dup$V2[features_dup$V1 == "303" | features_dup$V1 == "317"]
```

```
[1] "fBodyAcc-bandsEnergy()-1,8-w1-x" "fBodyAcc-bandsEnergy()-1,8-w1-y"
```
This fixes the problem with the duplicate variable names. Next, is to remove the dashes, underscores, capitalization, dots from the variable names.

## Making nice variable names
We can see now that the duplicate problem has been fixed. Both, the original variable name and the new name or nice, are shown side by side. Additionally, it can be noticed at the end that the row 317, which was a duplicate value of row 303, now it is showing corrected on the `nice` column.


```r
  # merge the original dataframe with the duplicates dataframe
  features_merged <- merge_with_duplicates(features2, features_dup)
  
  features_nice <- convert_to_nice_names(features_merged)
  
  features_nice[303:317, c("original", "nice")]    # return only one column. Use only in the CodeBook.md
```

```
                        original                       nice
303   fBodyAcc-bandsEnergy()-1,8   fbodyaccbandsenergy18w1x
304  fBodyAcc-bandsEnergy()-9,16  fbodyaccbandsenergy916w1x
305 fBodyAcc-bandsEnergy()-17,24 fbodyaccbandsenergy1724w1x
306 fBodyAcc-bandsEnergy()-25,32 fbodyaccbandsenergy2532w1x
307 fBodyAcc-bandsEnergy()-33,40 fbodyaccbandsenergy3340w1x
308 fBodyAcc-bandsEnergy()-41,48 fbodyaccbandsenergy4148w1x
309 fBodyAcc-bandsEnergy()-49,56 fbodyaccbandsenergy4956w1x
310 fBodyAcc-bandsEnergy()-57,64 fbodyaccbandsenergy5764w1x
311  fBodyAcc-bandsEnergy()-1,16  fbodyaccbandsenergy116w2x
312 fBodyAcc-bandsEnergy()-17,32 fbodyaccbandsenergy1732w2x
313 fBodyAcc-bandsEnergy()-33,48 fbodyaccbandsenergy3348w2x
314 fBodyAcc-bandsEnergy()-49,64 fbodyaccbandsenergy4964w2x
315  fBodyAcc-bandsEnergy()-1,24  fbodyaccbandsenergy124w3x
316 fBodyAcc-bandsEnergy()-25,48 fbodyaccbandsenergy2548w3x
317   fBodyAcc-bandsEnergy()-1,8   fbodyaccbandsenergy18w1y
```



## Assign descriptive names to the train data set
Now that the variable names have been fixed regarding the duplicates and the naming convention, it is time to assign these variable names to the measurements data frames `train` and `test`. The process to fix the variable names is all performed inside the function `compose_features()`. This functions returns a vector of corrected or fixed names which will be assigned to the variable `valid_column_names`. Like this:

                        `valid_column_names <<- compose_features(fileName)`

This variable is then used inside the function `compose()` where it is used to replace the original variable names in the data frames `train` and `test`. The `compose` function receives the name of the dataset, for instance, `train` or `test`, will replace this string in the file name objects by using the `gsub()` function by replacing the keyword _file_ by `test` or `train`. Then, will proceed to read the corresponding files and create the data frames:

```
    raw_measurements_data <- function(ds_name) {
      # read all raw measurement data sets
      # it will return a list that will be parse in the main function
      
      # filenames
      measurements_fn <- "./data/UCI HAR Dataset/file/X_file.txt"
      activities_fn   <- "./data/UCI HAR Dataset/file/y_file.txt"
      subjects_fn     <- "./data/UCI HAR Dataset/file/subject_file.txt"
      
      # replace <file> by <train> or <test>
      ds_files_v <- c(measurements_fn, activities_fn, subjects_fn)   # a vector of files to read
      ds_files   <- gsub("file", ds_name, ds_files_v)                # switch the identifier "_file" by "_train" or "_test"
      
      # this will make the list more readable
      mea <- read.table(ds_files[1])
      act <- read.table(ds_files[2])
      sub <- read.table(ds_files[3])
      
      return(list(measurements=mea, activities=act, subjects=sub))
    }
```


Let's see how this is done showing the before and after. This is just a little part of the code for explanation purposes. The complete code is in the script `run_analysis.R`. This reads the data from the `train` dataset file:

    train_measurements_raw <- raw_measurements_data("train")$measurements   # read test dataset: 62.9 MB
    test_measurements_raw  <- raw_measurements_data("test")$measurements


At this point, then, we have just have raw data in the table. Let's take a look at the data frame variable names:


```r
head(names(train_measurements_raw))
```

```
[1] "V1" "V2" "V3" "V4" "V5" "V6"
```

```r
tail(names(train_measurements_raw))
```

```
[1] "V556" "V557" "V558" "V559" "V560" "V561"
```
These are the variable names from the raw data frame. Let's see them after they are reassigned after the variable names have been fixed. We will use the function `compose()` which make this transformation when we send `ds_name` with the `train` dataset name:




```r
  # assign correct variable names to measurement data frames
  # add column names to measurements. assign features to variables in measurements datasets
  train_measurements <- assign_valid_names(train_measurements_raw, valid_column_names)
  test_measurements  <- assign_valid_names(test_measurements_raw,  valid_column_names)
```


And we show few of the variable names: 

```r
names(train_measurements[10:20])
```

```
 [1] "tbodyaccmaxx"    "tbodyaccmaxy"    "tbodyaccmaxz"   
 [4] "tbodyaccminx"    "tbodyaccminy"    "tbodyaccminz"   
 [7] "tbodyaccsma"     "tbodyaccenergyx" "tbodyaccenergyy"
[10] "tbodyaccenergyz" "tbodyacciqrx"   
```


```r
names(test_measurements[10:20])
```

```
 [1] "tbodyaccmaxx"    "tbodyaccmaxy"    "tbodyaccmaxz"   
 [4] "tbodyaccminx"    "tbodyaccminy"    "tbodyaccminz"   
 [7] "tbodyaccsma"     "tbodyaccenergyx" "tbodyaccenergyy"
[10] "tbodyaccenergyz" "tbodyacciqrx"   
```


We see that that the `train` data frame has now correct, fixed, non-duplicate names as well as any special characters have been removed. 

__According to the recommendations from Jeff Leek during the class we should not allow spaces, underscores, dashes, capital letters or uppercase. Lowercase is preferred.__

We do the same thing for the `test` data frame using the `compose()` function. Now, we will select only the variable names that have the keywords `mean` and `std` (for standard deviation).


## Keeping only the mean and std-dev variables


```r
  # Keep only mean and std-dev variables in measurements dataset 
  
  keywords <- c("mean", "std")
  train_measurements_select <- select_columns_with_expression(train_measurements, keywords)
  test_measurements_select  <- select_columns_with_expression(test_measurements,  keywords)
  
  length(train_measurements_select)
```

```
[1] 86
```

```r
  length(test_measurements_select)
```

```
[1] 86
```
Originally there were 561 columns or variables.

## Read subjects dataset

    train_subjects_raw     <- raw_measurements_data("train")$subjects 
    test_subjects_raw     <- raw_measurements_data("test")$subjects 


```r
  unique(train_subjects_raw$V1)
```

```
 [1]  1  3  5  6  7  8 11 14 15 16 17 19 21 22 23 25 26 27 28 29 30
```

```r
  unique(test_subjects_raw$V1)
```

```
[1]  2  4  9 10 12 13 18 20 24
```


## Merging datasets
This action has 3 parts:

1. Merging the train_activities table with the activities table (with descriptive names)

2. Merging the joined table above (train_activities_inner) with the train measurments dataset.

3. Merging the subjects table with train table




```r
  # add activity labels to raw activities
  train_activities_with_labels <- merge_activity_labels(train_activities_raw, activity_labels)
  test_activities_with_labels  <- merge_activity_labels(test_activities_raw,  activity_labels)
  
  # merge measurements, activities and subjects
  train_merged <- merge_all(train_measurements_select, train_activities_with_labels, train_subjects_raw)
  test_merged  <- merge_all(test_measurements_select,  test_activities_with_labels,  test_subjects_raw)
  
  # merge the measurement datasets for training and testing
  # rows:     10299
  # columns:  92
  # contains: (1) measurements for training and tests; (2) subjects; (3) activities
  train_test_merged <<- rbind(train_merged, test_merged) %>%
    mutate(row_num = row_number())      # add row_num to be able to reorder table in the future
```


__Summary of train activities merged with labels__

```r
  str(train_activities_with_labels)
```

```
'data.frame':	7352 obs. of  3 variables:
 $ activity_id    : int  5 5 5 5 5 5 5 5 5 5 ...
 $ activity_rownum: int  1 2 3 4 5 6 7 8 9 10 ...
 $ activity_name  : Factor w/ 6 levels "LAYING","SITTING",..: 3 3 3 3 3 3 3 3 3 3 ...
```

__Summary of test activities merged with labels__

```r
  str(test_activities_with_labels)
```

```
'data.frame':	2947 obs. of  3 variables:
 $ activity_id    : int  5 5 5 5 5 5 5 5 5 5 ...
 $ activity_rownum: int  1 2 3 4 5 6 7 8 9 10 ...
 $ activity_name  : Factor w/ 6 levels "LAYING","SITTING",..: 3 3 3 3 3 3 3 3 3 3 ...
```

  
__data frame `train`  merged with activities and subjects__

```r
  str(train_merged[1:25])
```

```
'data.frame':	7352 obs. of  25 variables:
 $ subjects_id      : int  1 1 1 1 1 1 1 1 1 1 ...
 $ activity_id      : int  5 5 5 5 5 5 5 5 5 5 ...
 $ activity_name    : Factor w/ 6 levels "LAYING","SITTING",..: 3 3 3 3 3 3 3 3 3 3 ...
 $ tbodyaccmeanx    : num  0.289 0.278 0.28 0.279 0.277 ...
 $ tbodyaccmeany    : num  -0.0203 -0.0164 -0.0195 -0.0262 -0.0166 ...
 $ tbodyaccmeanz    : num  -0.133 -0.124 -0.113 -0.123 -0.115 ...
 $ tbodyaccstdx     : num  -0.995 -0.998 -0.995 -0.996 -0.998 ...
 $ tbodyaccstdy     : num  -0.983 -0.975 -0.967 -0.983 -0.981 ...
 $ tbodyaccstdz     : num  -0.914 -0.96 -0.979 -0.991 -0.99 ...
 $ tgravityaccmeanx : num  0.963 0.967 0.967 0.968 0.968 ...
 $ tgravityaccmeany : num  -0.141 -0.142 -0.142 -0.144 -0.149 ...
 $ tgravityaccmeanz : num  0.1154 0.1094 0.1019 0.0999 0.0945 ...
 $ tgravityaccstdx  : num  -0.985 -0.997 -1 -0.997 -0.998 ...
 $ tgravityaccstdy  : num  -0.982 -0.989 -0.993 -0.981 -0.988 ...
 $ tgravityaccstdz  : num  -0.878 -0.932 -0.993 -0.978 -0.979 ...
 $ tbodyaccjerkmeanx: num  0.078 0.074 0.0736 0.0773 0.0734 ...
 $ tbodyaccjerkmeany: num  0.005 0.00577 0.0031 0.02006 0.01912 ...
 $ tbodyaccjerkmeanz: num  -0.06783 0.02938 -0.00905 -0.00986 0.01678 ...
 $ tbodyaccjerkstdx : num  -0.994 -0.996 -0.991 -0.993 -0.996 ...
 $ tbodyaccjerkstdy : num  -0.988 -0.981 -0.981 -0.988 -0.988 ...
 $ tbodyaccjerkstdz : num  -0.994 -0.992 -0.99 -0.993 -0.992 ...
 $ tbodygyromeanx   : num  -0.0061 -0.0161 -0.0317 -0.0434 -0.034 ...
 $ tbodygyromeany   : num  -0.0314 -0.0839 -0.1023 -0.0914 -0.0747 ...
 $ tbodygyromeanz   : num  0.1077 0.1006 0.0961 0.0855 0.0774 ...
 $ tbodygyrostdx    : num  -0.985 -0.983 -0.976 -0.991 -0.985 ...
```

__data frame `test` merged with activities and subjects__


```r
  str(test_merged[1:25])
```

```
'data.frame':	2947 obs. of  25 variables:
 $ subjects_id      : int  2 2 2 2 2 2 2 2 2 2 ...
 $ activity_id      : int  5 5 5 5 5 5 5 5 5 5 ...
 $ activity_name    : Factor w/ 6 levels "LAYING","SITTING",..: 3 3 3 3 3 3 3 3 3 3 ...
 $ tbodyaccmeanx    : num  0.257 0.286 0.275 0.27 0.275 ...
 $ tbodyaccmeany    : num  -0.0233 -0.0132 -0.0261 -0.0326 -0.0278 ...
 $ tbodyaccmeanz    : num  -0.0147 -0.1191 -0.1182 -0.1175 -0.1295 ...
 $ tbodyaccstdx     : num  -0.938 -0.975 -0.994 -0.995 -0.994 ...
 $ tbodyaccstdy     : num  -0.92 -0.967 -0.97 -0.973 -0.967 ...
 $ tbodyaccstdz     : num  -0.668 -0.945 -0.963 -0.967 -0.978 ...
 $ tgravityaccmeanx : num  0.936 0.927 0.93 0.929 0.927 ...
 $ tgravityaccmeany : num  -0.283 -0.289 -0.288 -0.293 -0.303 ...
 $ tgravityaccmeanz : num  0.115 0.153 0.146 0.143 0.138 ...
 $ tgravityaccstdx  : num  -0.925 -0.989 -0.996 -0.993 -0.996 ...
 $ tgravityaccstdy  : num  -0.937 -0.984 -0.988 -0.97 -0.971 ...
 $ tgravityaccstdz  : num  -0.564 -0.965 -0.982 -0.992 -0.968 ...
 $ tbodyaccjerkmeanx: num  0.072 0.0702 0.0694 0.0749 0.0784 ...
 $ tbodyaccjerkmeany: num  0.04575 -0.01788 -0.00491 0.03227 0.02228 ...
 $ tbodyaccjerkmeanz: num  -0.10604 -0.00172 -0.01367 0.01214 0.00275 ...
 $ tbodyaccjerkstdx : num  -0.907 -0.949 -0.991 -0.991 -0.992 ...
 $ tbodyaccjerkstdy : num  -0.938 -0.973 -0.971 -0.973 -0.979 ...
 $ tbodyaccjerkstdz : num  -0.936 -0.978 -0.973 -0.976 -0.987 ...
 $ tbodygyromeanx   : num  0.11998 -0.00155 -0.04821 -0.05664 -0.05999 ...
 $ tbodygyromeany   : num  -0.0918 -0.1873 -0.1663 -0.126 -0.0847 ...
 $ tbodygyromeanz   : num  0.1896 0.1807 0.1542 0.1183 0.0787 ...
 $ tbodygyrostdx    : num  -0.883 -0.926 -0.973 -0.968 -0.975 ...
```

__Total merge of train and test data frames__

```r
  head(train_test_merged[1:20])       # only the first 20 variables
```

```
  subjects_id activity_id activity_name tbodyaccmeanx tbodyaccmeany
1           1           5      STANDING     0.2885845   -0.02029417
2           1           5      STANDING     0.2784188   -0.01641057
3           1           5      STANDING     0.2796531   -0.01946716
4           1           5      STANDING     0.2791739   -0.02620065
5           1           5      STANDING     0.2766288   -0.01656965
6           1           5      STANDING     0.2771988   -0.01009785
  tbodyaccmeanz tbodyaccstdx tbodyaccstdy tbodyaccstdz tgravityaccmeanx
1    -0.1329051   -0.9952786   -0.9831106   -0.9135264        0.9633961
2    -0.1235202   -0.9982453   -0.9753002   -0.9603220        0.9665611
3    -0.1134617   -0.9953796   -0.9671870   -0.9789440        0.9668781
4    -0.1232826   -0.9960915   -0.9834027   -0.9906751        0.9676152
5    -0.1153619   -0.9981386   -0.9808173   -0.9904816        0.9682244
6    -0.1051373   -0.9973350   -0.9904868   -0.9954200        0.9679482
  tgravityaccmeany tgravityaccmeanz tgravityaccstdx tgravityaccstdy
1       -0.1408397       0.11537494      -0.9852497      -0.9817084
2       -0.1415513       0.10937881      -0.9974113      -0.9894474
3       -0.1420098       0.10188392      -0.9995740      -0.9928658
4       -0.1439765       0.09985014      -0.9966456      -0.9813928
5       -0.1487502       0.09448590      -0.9984293      -0.9880982
6       -0.1482100       0.09190972      -0.9989793      -0.9867539
  tgravityaccstdz tbodyaccjerkmeanx tbodyaccjerkmeany tbodyaccjerkmeanz
1      -0.8776250        0.07799634       0.005000803      -0.067830808
2      -0.9316387        0.07400671       0.005771104       0.029376633
3      -0.9929172        0.07363596       0.003104037      -0.009045631
4      -0.9784764        0.07732061       0.020057642      -0.009864772
5      -0.9787449        0.07344436       0.019121574       0.016779979
6      -0.9973064        0.07793244       0.018684046       0.009344434
  tbodyaccjerkstdx tbodyaccjerkstdy
1       -0.9935191       -0.9883600
2       -0.9955481       -0.9810636
3       -0.9907428       -0.9809556
4       -0.9926974       -0.9875527
5       -0.9964202       -0.9883587
6       -0.9948136       -0.9887145
```

```r
  tail(train_test_merged[1:20])       # only the last 20
```

```
      subjects_id activity_id    activity_name tbodyaccmeanx tbodyaccmeany
10294          24           2 WALKING_UPSTAIRS     0.1922746   -0.03364257
10295          24           2 WALKING_UPSTAIRS     0.3101546   -0.05339125
10296          24           2 WALKING_UPSTAIRS     0.3633846   -0.03921402
10297          24           2 WALKING_UPSTAIRS     0.3499661    0.03007744
10298          24           2 WALKING_UPSTAIRS     0.2375938    0.01846687
10299          24           2 WALKING_UPSTAIRS     0.1536272   -0.01843651
      tbodyaccmeanz tbodyaccstdx tbodyaccstdy tbodyaccstdz
10294   -0.10594911   -0.3548408  -0.09250435   -0.3129097
10295   -0.09910872   -0.2878663  -0.14058918   -0.2150877
10296   -0.10591509   -0.3053880   0.02814774   -0.1963729
10297   -0.11578796   -0.3296381  -0.04214289   -0.2501807
10298   -0.09649893   -0.3231143  -0.22977539   -0.2075736
10299   -0.13701846   -0.3300460  -0.19525335   -0.1643388
      tgravityaccmeanx tgravityaccmeany tgravityaccmeanz tgravityaccstdx
10294        0.8891608       -0.2875003       -0.2266255      -0.9831356
10295        0.8909677       -0.2767180       -0.2315935      -0.9807982
10296        0.8912809       -0.2749762       -0.2280502      -0.9817830
10297        0.8908972       -0.2761645       -0.2262558      -0.9828841
10298        0.8927357       -0.2623564       -0.2351080      -0.9859829
10299        0.8943309       -0.2614073       -0.2361121      -0.9847364
      tgravityaccstdy tgravityaccstdz tbodyaccjerkmeanx tbodyaccjerkmeany
10294      -0.9518960      -0.9606073       -0.20692245        0.34231930
10295      -0.9203893      -0.9494664       -0.08800546       -0.23149161
10296      -0.9295222      -0.9346775        0.14876453       -0.34446444
10297      -0.9333010      -0.9400140        0.04632680       -0.17497360
10298      -0.9621989      -0.9489939        0.33455894       -0.05912225
10299      -0.9645770      -0.9623691        0.22380428        0.25668687
      tbodyaccjerkmeanz tbodyaccjerkstdx tbodyaccjerkstdy
10294        0.39761326       -0.4914103       -0.5116664
10295        0.03601473       -0.4167254       -0.5212051
10296       -0.13128210       -0.3620992       -0.4023177
10297        0.20084196       -0.3893490       -0.4320439
10298        0.02002424       -0.4418078       -0.5788833
10299        0.01281710       -0.4790768       -0.5687591
```


# The Assignment question


```r
  # assignment question: group by subjects and activities summarizing selected columns by the mean
  # data frame: train_test_merged
  # group by subjects and activities
  by_SubjectActivity <- group_by(train_test_merged, subjects_id, activity_name)
  
  # summary showing the mean of mean and std columns by subjects and activities
  # acting on the merged measurement data frames
  # assign select variable names (mean, std) to a vector
  mean_std_vars <- get_variables_matching_keywords(valid_column_names, keywords)
  
  # summary
  sum_SubjectActivity <<- summarize_at(by_SubjectActivity, .cols = mean_std_vars,
                                       .funs = mean) 
```

The selected variables with `mean` and `std` keywords


```
      [,1]                   [,2]                               
 [1,] "tbodyaccmeanx"        "fbodyaccstdx"                     
 [2,] "tbodyaccmeany"        "fbodyaccstdy"                     
 [3,] "tbodyaccmeanz"        "fbodyaccstdz"                     
 [4,] "tbodyaccstdx"         "fbodyaccmeanfreqx"                
 [5,] "tbodyaccstdy"         "fbodyaccmeanfreqy"                
 [6,] "tbodyaccstdz"         "fbodyaccmeanfreqz"                
 [7,] "tgravityaccmeanx"     "fbodyaccjerkmeanx"                
 [8,] "tgravityaccmeany"     "fbodyaccjerkmeany"                
 [9,] "tgravityaccmeanz"     "fbodyaccjerkmeanz"                
[10,] "tgravityaccstdx"      "fbodyaccjerkstdx"                 
[11,] "tgravityaccstdy"      "fbodyaccjerkstdy"                 
[12,] "tgravityaccstdz"      "fbodyaccjerkstdz"                 
[13,] "tbodyaccjerkmeanx"    "fbodyaccjerkmeanfreqx"            
[14,] "tbodyaccjerkmeany"    "fbodyaccjerkmeanfreqy"            
[15,] "tbodyaccjerkmeanz"    "fbodyaccjerkmeanfreqz"            
[16,] "tbodyaccjerkstdx"     "fbodygyromeanx"                   
[17,] "tbodyaccjerkstdy"     "fbodygyromeany"                   
[18,] "tbodyaccjerkstdz"     "fbodygyromeanz"                   
[19,] "tbodygyromeanx"       "fbodygyrostdx"                    
[20,] "tbodygyromeany"       "fbodygyrostdy"                    
[21,] "tbodygyromeanz"       "fbodygyrostdz"                    
[22,] "tbodygyrostdx"        "fbodygyromeanfreqx"               
[23,] "tbodygyrostdy"        "fbodygyromeanfreqy"               
[24,] "tbodygyrostdz"        "fbodygyromeanfreqz"               
[25,] "tbodygyrojerkmeanx"   "fbodyaccmagmean"                  
[26,] "tbodygyrojerkmeany"   "fbodyaccmagstd"                   
[27,] "tbodygyrojerkmeanz"   "fbodyaccmagmeanfreq"              
[28,] "tbodygyrojerkstdx"    "fbodybodyaccjerkmagmean"          
[29,] "tbodygyrojerkstdy"    "fbodybodyaccjerkmagstd"           
[30,] "tbodygyrojerkstdz"    "fbodybodyaccjerkmagmeanfreq"      
[31,] "tbodyaccmagmean"      "fbodybodygyromagmean"             
[32,] "tbodyaccmagstd"       "fbodybodygyromagstd"              
[33,] "tgravityaccmagmean"   "fbodybodygyromagmeanfreq"         
[34,] "tgravityaccmagstd"    "fbodybodygyrojerkmagmean"         
[35,] "tbodyaccjerkmagmean"  "fbodybodygyrojerkmagstd"          
[36,] "tbodyaccjerkmagstd"   "fbodybodygyrojerkmagmeanfreq"     
[37,] "tbodygyromagmean"     "angletbodyaccmeangravity"         
[38,] "tbodygyromagstd"      "angletbodyaccjerkmeangravitymean" 
[39,] "tbodygyrojerkmagmean" "angletbodygyromeangravitymean"    
[40,] "tbodygyrojerkmagstd"  "angletbodygyrojerkmeangravitymean"
[41,] "fbodyaccmeanx"        "anglexgravitymean"                
[42,] "fbodyaccmeany"        "angleygravitymean"                
[43,] "fbodyaccmeanz"        "anglezgravitymean"                
```
The first 20 observations and 20 variables of the summary

```r
  head(sum_SubjectActivity[1:20])
```

```
Source: local data frame [6 x 20]
Groups: subjects_id [1]

  subjects_id      activity_name tbodyaccmeanx tbodyaccmeany tbodyaccmeanz
        <int>             <fctr>         <dbl>         <dbl>         <dbl>
1           1             LAYING     0.2215982  -0.040513953    -0.1132036
2           1            SITTING     0.2612376  -0.001308288    -0.1045442
3           1           STANDING     0.2789176  -0.016137590    -0.1106018
4           1            WALKING     0.2773308  -0.017383819    -0.1111481
5           1 WALKING_DOWNSTAIRS     0.2891883  -0.009918505    -0.1075662
6           1   WALKING_UPSTAIRS     0.2554617  -0.023953149    -0.0973020
# ... with 15 more variables: tbodyaccstdx <dbl>, tbodyaccstdy <dbl>,
#   tbodyaccstdz <dbl>, tgravityaccmeanx <dbl>, tgravityaccmeany <dbl>,
#   tgravityaccmeanz <dbl>, tgravityaccstdx <dbl>, tgravityaccstdy <dbl>,
#   tgravityaccstdz <dbl>, tbodyaccjerkmeanx <dbl>,
#   tbodyaccjerkmeany <dbl>, tbodyaccjerkmeanz <dbl>,
#   tbodyaccjerkstdx <dbl>, tbodyaccjerkstdy <dbl>, tbodyaccjerkstdz <dbl>
```

The last 20 observations of summary


```r
  tail(sum_SubjectActivity[1:20])
```

```
Source: local data frame [6 x 20]
Groups: subjects_id [1]

  subjects_id      activity_name tbodyaccmeanx tbodyaccmeany tbodyaccmeanz
        <int>             <fctr>         <dbl>         <dbl>         <dbl>
1          30             LAYING     0.2810339  -0.019449410   -0.10365815
2          30            SITTING     0.2683361  -0.008047313   -0.09951545
3          30           STANDING     0.2771127  -0.017016389   -0.10875621
4          30            WALKING     0.2764068  -0.017588039   -0.09862471
5          30 WALKING_DOWNSTAIRS     0.2831906  -0.017438390   -0.09997814
6          30   WALKING_UPSTAIRS     0.2714156  -0.025331170   -0.12469749
# ... with 15 more variables: tbodyaccstdx <dbl>, tbodyaccstdy <dbl>,
#   tbodyaccstdz <dbl>, tgravityaccmeanx <dbl>, tgravityaccmeany <dbl>,
#   tgravityaccmeanz <dbl>, tgravityaccstdx <dbl>, tgravityaccstdy <dbl>,
#   tgravityaccstdz <dbl>, tbodyaccjerkmeanx <dbl>,
#   tbodyaccjerkmeany <dbl>, tbodyaccjerkmeanz <dbl>,
#   tbodyaccjerkstdx <dbl>, tbodyaccjerkstdy <dbl>, tbodyaccjerkstdz <dbl>
```

## Exporting the data

```r
  # output of tidy dataset containing summary of subjects and activities 
  # and the mean of selected columns.
  write.table(sum_SubjectActivity, "sum_subjects_activities.txt")
```


```r
  summary_read <- read.table("sum_subjects_activities.txt")
  short_summary(summary_read)
```

```
Observations: 	 180 			First variables: subjects_id activity_name tbodyaccmeanx tbodyaccmeany tbodyaccmeanz tbodyaccstdx 
Variables: 	 88 			Last variables: angletbodyaccjerkmeangravitymean angletbodygyromeangravitymean angletbodygyrojerkmeangravitymean anglexgravitymean angleygravitymean anglezgravitymean 

First observations
  subjects_id tbodygyromeany fbodyaccmeany fbodygyrostdz anglezgravitymean
1           1    -0.06448612  -0.867065205    -0.9165825       -0.35241311
2           1    -0.09192415  -0.944084550    -0.9439178       -0.21801723
3           1    -0.05939722  -0.977070848    -0.9823453        0.01225285
4           1    -0.06953005   0.089712726    -0.4365622        0.06885891
5           1    -0.09093713   0.001549908    -0.2384436        0.06500471
6           1    -0.16617002  -0.190976721    -0.5717078        0.07416637

Summary of selected variables
```

```
  subjects_id   tbodygyromeany     fbodyaccmeany      fbodygyrostdz    
 Min.   : 1.0   Min.   :-0.20421   Min.   :-0.98903   Min.   :-0.9867  
 1st Qu.: 8.0   1st Qu.:-0.08955   1st Qu.:-0.95361   1st Qu.:-0.9643  
 Median :15.5   Median :-0.07318   Median :-0.59498   Median :-0.8224  
 Mean   :15.5   Mean   :-0.07426   Mean   :-0.48873   Mean   :-0.6577  
 3rd Qu.:23.0   3rd Qu.:-0.06113   3rd Qu.:-0.06341   3rd Qu.:-0.3916  
 Max.   :30.0   Max.   : 0.02747   Max.   : 0.52419   Max.   : 0.5225  
 anglezgravitymean  
 Min.   :-0.873649  
 1st Qu.:-0.083912  
 Median : 0.005079  
 Mean   :-0.040436  
 3rd Qu.: 0.106190  
 Max.   : 0.390444  
```


# Getting the data. Acquiring the datasets
This is optional. If we require a fresh set of files, we can get them by turning on the flag `fromSource` with `TRUE`.
We start by downloading the zipped file containing all the datasets and associated files. We load the library `downloader` to allow us the use of the function `download()`. Since we want to make this analysis reproducible, we added the capability of detecting if the folder `data` exists in the folder structure. If it doesn't exist, the script will create it for the user. Downloading and extracting the files will take few minutes. The main function `run_ana()` has this flag off but it can be activated at any moment.


```r
download_from_source <-function(fromSource = FALSE) {
  # this will download the dataset file from the original source if TRUE
  # sometime we mess up with the files. This is a back up measure
  if (fromSource == TRUE) {
    library(downloader)
    if(!file.exists("./data")){dir.create("./data")}
    
    fileUrl <- "https://d396qusza40orc.cloudfront.net/getdata%2Fprojectfiles%2FUCI%20HAR%20Dataset.zip"
    download(fileUrl, dest="dataset.zip", mode="wb") 
    unzip ("dataset.zip", exdir = "./data")
  }
}
```

# List of variables in the summary table
This is the list of selected variables (mean and standard deviation) that are part of the summary by _Subjects_ and _Activities_.


  V1  nice                                sensor          stats   acc_source   domain    
----  ----------------------------------  --------------  ------  -----------  ----------
   1  tbodyaccmeanx                       accelerometer   mean    Body         time      
   2  tbodyaccmeany                       accelerometer   mean    Body         time      
   3  tbodyaccmeanz                       accelerometer   mean    Body         time      
  41  tgravityaccmeanx                    accelerometer   mean    Body         time      
  42  tgravityaccmeany                    accelerometer   mean    Body         time      
  43  tgravityaccmeanz                    accelerometer   mean    Body         time      
 121  tbodygyromeanx                      accelerometer   mean    Gravity      time      
 122  tbodygyromeany                      accelerometer   mean    Gravity      time      
 123  tbodygyromeanz                      accelerometer   mean    Gravity      time      
 201  tbodyaccmagmean                     accelerometer   mean    Gravity      time      
 214  tgravityaccmagmean                  accelerometer   mean    Gravity      time      
 240  tbodygyromagmean                    accelerometer   mean    Gravity      time      
  81  tbodyaccjerkmeanx                   accelerometer   mean    Body         time      
  82  tbodyaccjerkmeany                   accelerometer   mean    Body         time      
  83  tbodyaccjerkmeanz                   accelerometer   mean    Body         time      
  84  tbodyaccjerkstdx                    accelerometer   std     Body         time      
  85  tbodyaccjerkstdy                    accelerometer   std     Body         time      
  86  tbodyaccjerkstdz                    accelerometer   std     Body         time      
 424  fbodygyromeanx                      accelerometer   mean    Body         frequency 
 425  fbodygyromeany                      accelerometer   mean    Body         frequency 
 426  fbodygyromeanz                      accelerometer   mean    Gravity      frequency 
 452  fbodygyromeanfreqx                  accelerometer   mean    Gravity      frequency 
 227  tbodyaccjerkmagmean                 accelerometer   mean    Body         time      
 228  tbodyaccjerkmagstd                  accelerometer   std     Body         time      
 503  fbodyaccmagmean                     accelerometer   mean    Body         frequency 
 513  fbodyaccmagmeanfreq                 accelerometer   mean    Body         frequency 
 529  fbodybodygyromagmean                accelerometer   mean    Body         frequency 
 539  fbodybodygyromagmeanfreq            accelerometer   mean    Body         frequency 
 555  angletbodyaccmeangravity            accelerometer   mean    Body         time      
 557  angletbodygyromeangravitymean       accelerometer   mean    Body         time      
 559  anglexgravitymean                   accelerometer   mean    Body         none      
 560  angleygravitymean                   accelerometer   mean    Body         none      
 561  anglezgravitymean                   accelerometer   mean    Body         none      
 345  fbodyaccjerkmeanx                   accelerometer   mean    Body         frequency 
 346  fbodyaccjerkmeany                   accelerometer   mean    Body         frequency 
 347  fbodyaccjerkmeanz                   accelerometer   mean    Body         frequency 
 348  fbodyaccjerkstdx                    accelerometer   std     Body         frequency 
 349  fbodyaccjerkstdy                    accelerometer   std     Body         frequency 
 350  fbodyaccjerkstdz                    accelerometer   std     Body         frequency 
 373  fbodyaccjerkmeanfreqx               accelerometer   mean    Body         frequency 
 374  fbodyaccjerkmeanfreqy               accelerometer   mean    Body         frequency 
 375  fbodyaccjerkmeanfreqz               accelerometer   mean    Body         frequency 
 202  tbodyaccmagstd                      accelerometer   std     Body         time      
 215  tgravityaccmagstd                   accelerometer   std     Body         time      
 241  tbodygyromagstd                     accelerometer   std     Body         time      
 516  fbodybodyaccjerkmagmean             accelerometer   mean    Body         frequency 
 517  fbodybodyaccjerkmagstd              accelerometer   std     Body         frequency 
 526  fbodybodyaccjerkmagmeanfreq         accelerometer   mean    Body         frequency 
 427  fbodygyrostdx                       accelerometer   std     Body         frequency 
 556  angletbodyaccjerkmeangravitymean    accelerometer   mean    Body         time      
 429  fbodygyrostdz                       accelerometer   std     Gravity      frequency 
 504  fbodyaccmagstd                      accelerometer   std     Gravity      frequency 
 530  fbodybodygyromagstd                 accelerometer   std     Gravity      frequency 
 266  fbodyaccmeanx                       gyroscope       mean    Body         frequency 
 267  fbodyaccmeany                       gyroscope       mean    Body         frequency 
 268  fbodyaccmeanz                       gyroscope       mean    Body         frequency 
 294  fbodyaccmeanfreqx                   gyroscope       mean    Body         frequency 
 295  fbodyaccmeanfreqy                   gyroscope       mean    Body         frequency 
 296  fbodyaccmeanfreqz                   gyroscope       mean    Body         frequency 
 161  tbodygyrojerkmeanx                  gyroscope       mean    Body         time      
 162  tbodygyrojerkmeany                  gyroscope       mean    Body         time      
 163  tbodygyrojerkmeanz                  gyroscope       mean    Body         time      
 164  tbodygyrojerkstdx                   gyroscope       std     Body         time      
 165  tbodygyrojerkstdy                   gyroscope       std     Body         time      
 166  tbodygyrojerkstdz                   gyroscope       std     Body         time      
 453  fbodygyromeanfreqy                  gyroscope       mean    Body         frequency 
 454  fbodygyromeanfreqz                  gyroscope       mean    Body         frequency 
 253  tbodygyrojerkmagmean                gyroscope       mean    Body         time      
 254  tbodygyrojerkmagstd                 gyroscope       std     Body         time      
   4  tbodyaccstdx                        gyroscope       std     Body         time      
   5  tbodyaccstdy                        gyroscope       std     Body         time      
   6  tbodyaccstdz                        gyroscope       std     Body         time      
  44  tgravityaccstdx                     gyroscope       std     Body         time      
  45  tgravityaccstdy                     gyroscope       std     Body         time      
  46  tgravityaccstdz                     gyroscope       std     Body         time      
 124  tbodygyrostdx                       gyroscope       std     Body         time      
 125  tbodygyrostdy                       gyroscope       std     Body         time      
 126  tbodygyrostdz                       gyroscope       std     Body         time      
 269  fbodyaccstdx                        gyroscope       std     Body         frequency 
 270  fbodyaccstdy                        gyroscope       std     Body         frequency 
 271  fbodyaccstdz                        gyroscope       std     Body         frequency 
 542  fbodybodygyrojerkmagmean            gyroscope       mean    Body         frequency 
 543  fbodybodygyrojerkmagstd             gyroscope       std     Body         frequency 
 552  fbodybodygyrojerkmagmeanfreq        gyroscope       mean    Body         frequency 
 428  fbodygyrostdy                       gyroscope       std     Body         frequency 
 558  angletbodygyrojerkmeangravitymean   gyroscope       mean    Body         time      


```r
library(pander)

pander(var_doc2)
```


-----------------------------------------------------------------------------------
 V1                nice                   sensor      stats   acc_source   domain  
---- --------------------------------- ------------- ------- ------------ ---------
 1             tbodyaccmeanx           accelerometer  mean       Body       time   

 2             tbodyaccmeany           accelerometer  mean       Body       time   

 3             tbodyaccmeanz           accelerometer  mean       Body       time   

 41          tgravityaccmeanx          accelerometer  mean       Body       time   

 42          tgravityaccmeany          accelerometer  mean       Body       time   

 43          tgravityaccmeanz          accelerometer  mean       Body       time   

121           tbodygyromeanx           accelerometer  mean     Gravity      time   

122           tbodygyromeany           accelerometer  mean     Gravity      time   

123           tbodygyromeanz           accelerometer  mean     Gravity      time   

201           tbodyaccmagmean          accelerometer  mean     Gravity      time   

214         tgravityaccmagmean         accelerometer  mean     Gravity      time   

240          tbodygyromagmean          accelerometer  mean     Gravity      time   

 81          tbodyaccjerkmeanx         accelerometer  mean       Body       time   

 82          tbodyaccjerkmeany         accelerometer  mean       Body       time   

 83          tbodyaccjerkmeanz         accelerometer  mean       Body       time   

 84          tbodyaccjerkstdx          accelerometer   std       Body       time   

 85          tbodyaccjerkstdy          accelerometer   std       Body       time   

 86          tbodyaccjerkstdz          accelerometer   std       Body       time   

424           fbodygyromeanx           accelerometer  mean       Body     frequency

425           fbodygyromeany           accelerometer  mean       Body     frequency

426           fbodygyromeanz           accelerometer  mean     Gravity    frequency

452         fbodygyromeanfreqx         accelerometer  mean     Gravity    frequency

227         tbodyaccjerkmagmean        accelerometer  mean       Body       time   

228         tbodyaccjerkmagstd         accelerometer   std       Body       time   

503           fbodyaccmagmean          accelerometer  mean       Body     frequency

513         fbodyaccmagmeanfreq        accelerometer  mean       Body     frequency

529        fbodybodygyromagmean        accelerometer  mean       Body     frequency

539      fbodybodygyromagmeanfreq      accelerometer  mean       Body     frequency

555      angletbodyaccmeangravity      accelerometer  mean       Body       time   

557    angletbodygyromeangravitymean   accelerometer  mean       Body       time   

559          anglexgravitymean         accelerometer  mean       Body       none   

560          angleygravitymean         accelerometer  mean       Body       none   

561          anglezgravitymean         accelerometer  mean       Body       none   

345          fbodyaccjerkmeanx         accelerometer  mean       Body     frequency

346          fbodyaccjerkmeany         accelerometer  mean       Body     frequency

347          fbodyaccjerkmeanz         accelerometer  mean       Body     frequency

348          fbodyaccjerkstdx          accelerometer   std       Body     frequency

349          fbodyaccjerkstdy          accelerometer   std       Body     frequency

350          fbodyaccjerkstdz          accelerometer   std       Body     frequency

373        fbodyaccjerkmeanfreqx       accelerometer  mean       Body     frequency

374        fbodyaccjerkmeanfreqy       accelerometer  mean       Body     frequency

375        fbodyaccjerkmeanfreqz       accelerometer  mean       Body     frequency

202           tbodyaccmagstd           accelerometer   std       Body       time   

215          tgravityaccmagstd         accelerometer   std       Body       time   

241           tbodygyromagstd          accelerometer   std       Body       time   

516       fbodybodyaccjerkmagmean      accelerometer  mean       Body     frequency

517       fbodybodyaccjerkmagstd       accelerometer   std       Body     frequency

526     fbodybodyaccjerkmagmeanfreq    accelerometer  mean       Body     frequency

427            fbodygyrostdx           accelerometer   std       Body     frequency

556  angletbodyaccjerkmeangravitymean  accelerometer  mean       Body       time   

429            fbodygyrostdz           accelerometer   std     Gravity    frequency

504           fbodyaccmagstd           accelerometer   std     Gravity    frequency

530         fbodybodygyromagstd        accelerometer   std     Gravity    frequency

266            fbodyaccmeanx             gyroscope    mean       Body     frequency

267            fbodyaccmeany             gyroscope    mean       Body     frequency

268            fbodyaccmeanz             gyroscope    mean       Body     frequency

294          fbodyaccmeanfreqx           gyroscope    mean       Body     frequency

295          fbodyaccmeanfreqy           gyroscope    mean       Body     frequency

296          fbodyaccmeanfreqz           gyroscope    mean       Body     frequency

161         tbodygyrojerkmeanx           gyroscope    mean       Body       time   

162         tbodygyrojerkmeany           gyroscope    mean       Body       time   

163         tbodygyrojerkmeanz           gyroscope    mean       Body       time   

164          tbodygyrojerkstdx           gyroscope     std       Body       time   

165          tbodygyrojerkstdy           gyroscope     std       Body       time   

166          tbodygyrojerkstdz           gyroscope     std       Body       time   

453         fbodygyromeanfreqy           gyroscope    mean       Body     frequency

454         fbodygyromeanfreqz           gyroscope    mean       Body     frequency

253        tbodygyrojerkmagmean          gyroscope    mean       Body       time   

254         tbodygyrojerkmagstd          gyroscope     std       Body       time   

 4             tbodyaccstdx              gyroscope     std       Body       time   

 5             tbodyaccstdy              gyroscope     std       Body       time   

 6             tbodyaccstdz              gyroscope     std       Body       time   

 44           tgravityaccstdx            gyroscope     std       Body       time   

 45           tgravityaccstdy            gyroscope     std       Body       time   

 46           tgravityaccstdz            gyroscope     std       Body       time   

124            tbodygyrostdx             gyroscope     std       Body       time   

125            tbodygyrostdy             gyroscope     std       Body       time   

126            tbodygyrostdz             gyroscope     std       Body       time   

269            fbodyaccstdx              gyroscope     std       Body     frequency

270            fbodyaccstdy              gyroscope     std       Body     frequency

271            fbodyaccstdz              gyroscope     std       Body     frequency

542      fbodybodygyrojerkmagmean        gyroscope    mean       Body     frequency

543       fbodybodygyrojerkmagstd        gyroscope     std       Body     frequency

552    fbodybodygyrojerkmagmeanfreq      gyroscope    mean       Body     frequency

428            fbodygyrostdy             gyroscope     std       Body     frequency

558  angletbodygyrojerkmeangravitymean   gyroscope    mean       Body       time   
-----------------------------------------------------------------------------------

